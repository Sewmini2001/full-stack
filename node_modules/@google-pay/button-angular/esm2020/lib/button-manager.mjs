/**
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* eslint-disable react/no-is-mounted */
import { loadScript } from '../lib/load-script';
/**
 * Manages the lifecycle of the Google Pay button.
 *
 * Includes lifecycle management of the `PaymentsClient` instance,
 * `isReadyToPay`, `onClick`, `loadPaymentData`, and other callback methods.
 */
export class ButtonManager {
    constructor(options) {
        /**
         * Handles the click event of the Google Pay button.
         *
         * This method would normally be private but has been made public for
         * testing purposes.
         *
         * @private
         */
        this.handleClick = async (event) => {
            const config = this.config;
            if (!config) {
                throw new Error('google-pay-button: Missing configuration');
            }
            const request = this.createLoadPaymentDataRequest(config);
            try {
                if (config.onClick) {
                    config.onClick(event);
                }
                if (event.defaultPrevented) {
                    return;
                }
                const result = await this.client.loadPaymentData(request);
                if (config.onLoadPaymentData) {
                    config.onLoadPaymentData(result);
                }
            }
            catch (err) {
                if (err.statusCode === 'CANCELED') {
                    if (config.onCancel) {
                        config.onCancel(err);
                    }
                }
                else if (config.onError) {
                    config.onError(err);
                }
                else {
                    console.error(err);
                }
            }
        };
        this.options = options;
    }
    getElement() {
        return this.element;
    }
    isGooglePayLoaded() {
        return 'google' in (window || global) && !!google?.payments?.api?.PaymentsClient;
    }
    async mount(element) {
        if (!this.isGooglePayLoaded()) {
            try {
                await loadScript('https://pay.google.com/gp/p/js/pay.js');
            }
            catch (err) {
                if (this.config?.onError) {
                    this.config.onError(err);
                }
                else {
                    console.error(err);
                }
            }
        }
        this.element = element;
        if (element) {
            this.appendStyles();
            if (this.config) {
                this.updateElement();
            }
        }
    }
    unmount() {
        this.element = undefined;
    }
    configure(newConfig) {
        let promise = undefined;
        this.config = newConfig;
        if (!this.oldInvalidationValues || this.isClientInvalidated(newConfig)) {
            promise = this.updateElement();
        }
        this.oldInvalidationValues = this.getInvalidationValues(newConfig);
        return promise ?? Promise.resolve();
    }
    /**
     * Creates client configuration options based on button configuration
     * options.
     *
     * This method would normally be private but has been made public for
     * testing purposes.
     *
     * @private
     */
    createClientOptions(config) {
        const clientConfig = {
            environment: config.environment,
            merchantInfo: this.createMerchantInfo(config),
        };
        if (config.onPaymentDataChanged || config.onPaymentAuthorized) {
            clientConfig.paymentDataCallbacks = {};
            if (config.onPaymentDataChanged) {
                // eslint-disable-next-line @typescript-eslint/explicit-function-return-type
                clientConfig.paymentDataCallbacks.onPaymentDataChanged = paymentData => {
                    const result = config.onPaymentDataChanged(paymentData);
                    return result || {};
                };
            }
            if (config.onPaymentAuthorized) {
                // eslint-disable-next-line @typescript-eslint/explicit-function-return-type
                clientConfig.paymentDataCallbacks.onPaymentAuthorized = paymentData => {
                    const result = config.onPaymentAuthorized(paymentData);
                    return result || {};
                };
            }
        }
        return clientConfig;
    }
    createIsReadyToPayRequest(config) {
        const paymentRequest = config.paymentRequest;
        const request = {
            apiVersion: paymentRequest.apiVersion,
            apiVersionMinor: paymentRequest.apiVersionMinor,
            allowedPaymentMethods: paymentRequest.allowedPaymentMethods,
            existingPaymentMethodRequired: config.existingPaymentMethodRequired,
        };
        return request;
    }
    /**
     * Constructs `loadPaymentData` request object based on button configuration.
     *
     * It infers request properties like `shippingAddressRequired`,
     * `shippingOptionRequired`, and `billingAddressRequired` if not already set
     * based on the presence of their associated options and parameters. It also
     * infers `callbackIntents` based on the callback methods defined in button
     * configuration.
     *
     * This method would normally be private but has been made public for
     * testing purposes.
     *
     * @private
     */
    createLoadPaymentDataRequest(config) {
        const request = {
            ...config.paymentRequest,
            merchantInfo: this.createMerchantInfo(config),
        };
        // TODO: #13 re-enable inferrence if/when we agree as a team
        return request;
    }
    createMerchantInfo(config) {
        const merchantInfo = {
            ...config.paymentRequest.merchantInfo,
        };
        // apply softwareInfo if not set
        if (!merchantInfo.softwareInfo) {
            merchantInfo.softwareInfo = {
                id: this.options.softwareInfoId,
                version: this.options.softwareInfoVersion,
            };
        }
        return merchantInfo;
    }
    isMounted() {
        return this.element != null && this.element.isConnected !== false;
    }
    removeButton() {
        if (this.element instanceof ShadowRoot || this.element instanceof Element) {
            for (const child of Array.from(this.element.children)) {
                if (child.tagName !== 'STYLE') {
                    child.remove();
                }
            }
        }
    }
    async updateElement() {
        if (!this.isMounted())
            return;
        const element = this.getElement();
        if (!this.config) {
            throw new Error('google-pay-button: Missing configuration');
        }
        // remove existing button
        this.removeButton();
        this.client = new google.payments.api.PaymentsClient(this.createClientOptions(this.config));
        const buttonOptions = {
            buttonType: this.config.buttonType,
            buttonColor: this.config.buttonColor,
            buttonSizeMode: this.config.buttonSizeMode,
            buttonLocale: this.config.buttonLocale,
            onClick: this.handleClick,
            allowedPaymentMethods: this.config.paymentRequest.allowedPaymentMethods,
        };
        const rootNode = element.getRootNode();
        if (rootNode instanceof ShadowRoot) {
            buttonOptions.buttonRootNode = rootNode;
        }
        // pre-create button
        const button = this.client.createButton(buttonOptions);
        this.setClassName(element, [element.className, 'not-ready']);
        element.appendChild(button);
        let showButton = false;
        let readyToPay;
        try {
            readyToPay = await this.client.isReadyToPay(this.createIsReadyToPayRequest(this.config));
            showButton =
                (readyToPay.result && !this.config.existingPaymentMethodRequired)
                    || (readyToPay.result && readyToPay.paymentMethodPresent && this.config.existingPaymentMethodRequired)
                    || false;
        }
        catch (err) {
            if (this.config.onError) {
                this.config.onError(err);
            }
            else {
                console.error(err);
            }
        }
        if (!this.isMounted())
            return;
        if (showButton) {
            try {
                this.client.prefetchPaymentData(this.createLoadPaymentDataRequest(this.config));
            }
            catch (err) {
                console.log('Error with prefetch', err);
            }
            // remove hidden className
            this.setClassName(element, (element.className || '').split(' ').filter(className => className && className !== 'not-ready'));
        }
        if (this.isReadyToPay !== readyToPay?.result || this.paymentMethodPresent !== readyToPay?.paymentMethodPresent) {
            this.isReadyToPay = !!readyToPay?.result;
            this.paymentMethodPresent = readyToPay?.paymentMethodPresent;
            if (this.config.onReadyToPayChange) {
                const readyToPayResponse = {
                    isButtonVisible: showButton,
                    isReadyToPay: this.isReadyToPay,
                };
                if (this.paymentMethodPresent) {
                    readyToPayResponse.paymentMethodPresent = this.paymentMethodPresent;
                }
                this.config.onReadyToPayChange(readyToPayResponse);
            }
        }
    }
    setClassName(element, classNames) {
        const className = classNames.filter(name => name).join(' ');
        if (className) {
            element.className = className;
        }
        else {
            element.removeAttribute('class');
        }
    }
    appendStyles() {
        if (typeof document === 'undefined')
            return;
        const rootNode = this.element?.getRootNode();
        const styleId = `default-google-style-${this.options.cssSelector.replace(/[^\w-]+/g, '')}-${this.config?.buttonLocale}`;
        // initialize styles if rendering on the client:
        if (rootNode) {
            if (!rootNode.getElementById?.(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.type = 'text/css';
                style.innerHTML = `
          ${this.options.cssSelector} {
            display: inline-block;
          }
          ${this.options.cssSelector}.not-ready {
            width: 0;
            height: 0;
            overflow: hidden;
          }
        `;
                if (rootNode instanceof Document && rootNode.head) {
                    rootNode.head.appendChild(style);
                }
                else {
                    rootNode.appendChild(style);
                }
            }
        }
    }
    isClientInvalidated(newConfig) {
        if (!this.oldInvalidationValues)
            return true;
        const newValues = this.getInvalidationValues(newConfig);
        return newValues.some((value, index) => value !== this.oldInvalidationValues[index]);
    }
    getInvalidationValues(config) {
        return [
            config.environment,
            config.existingPaymentMethodRequired,
            !!config.onPaymentDataChanged,
            !!config.onPaymentAuthorized,
            config.buttonColor,
            config.buttonType,
            config.buttonLocale,
            config.buttonSizeMode,
            config.paymentRequest.merchantInfo.merchantId,
            config.paymentRequest.merchantInfo.merchantName,
            config.paymentRequest.merchantInfo.softwareInfo?.id,
            config.paymentRequest.merchantInfo.softwareInfo?.version,
            config.paymentRequest.allowedPaymentMethods,
        ];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV0dG9uLW1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9saWIvYnV0dG9uLW1hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7O0dBY0c7QUFFSCx3Q0FBd0M7QUFFeEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBK0JoRDs7Ozs7R0FLRztBQUNILE1BQU0sT0FBTyxhQUFhO0lBVXhCLFlBQVksT0FBNkI7UUErT3pDOzs7Ozs7O1dBT0c7UUFDSCxnQkFBVyxHQUFHLEtBQUssRUFBRSxLQUFZLEVBQWlCLEVBQUU7WUFDbEQsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUMzQixJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsMENBQTBDLENBQUMsQ0FBQzthQUM3RDtZQUVELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUUxRCxJQUFJO2dCQUNGLElBQUksTUFBTSxDQUFDLE9BQU8sRUFBRTtvQkFDbEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztpQkFDdkI7Z0JBRUQsSUFBSSxLQUFLLENBQUMsZ0JBQWdCLEVBQUU7b0JBQzFCLE9BQU87aUJBQ1I7Z0JBRUQsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFFM0QsSUFBSSxNQUFNLENBQUMsaUJBQWlCLEVBQUU7b0JBQzVCLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztpQkFDbEM7YUFDRjtZQUFDLE9BQU8sR0FBRyxFQUFFO2dCQUNaLElBQUssR0FBeUMsQ0FBQyxVQUFVLEtBQUssVUFBVSxFQUFFO29CQUN4RSxJQUFJLE1BQU0sQ0FBQyxRQUFRLEVBQUU7d0JBQ25CLE1BQU0s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QUMsWUFBWSxDQUFDLFlBQVksRUFBRSxPQUFPO1lBQ3hELE1BQU0sQ0FBQyxjQUFjLENBQUMscUJBQXFCO1NBQzVDLENBQUM7SUFDSixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbi8qIGVzbGludC1kaXNhYmxlIHJlYWN0L25vLWlzLW1vdW50ZWQgKi9cblxuaW1wb3J0IHsgbG9hZFNjcmlwdCB9IGZyb20gJy4uL2xpYi9sb2FkLXNjcmlwdCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVhZHlUb1BheUNoYW5nZVJlc3BvbnNlIHtcbiAgaXNCdXR0b25WaXNpYmxlOiBib29sZWFuO1xuICBpc1JlYWR5VG9QYXk6IGJvb2xlYW47XG4gIHBheW1lbnRNZXRob2RQcmVzZW50PzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb25maWcge1xuICBlbnZpcm9ubWVudDogZ29vZ2xlLnBheW1lbnRzLmFwaS5FbnZpcm9ubWVudDtcbiAgZXhpc3RpbmdQYXltZW50TWV0aG9kUmVxdWlyZWQ/OiBib29sZWFuO1xuICBwYXltZW50UmVxdWVzdDogZ29vZ2xlLnBheW1lbnRzLmFwaS5QYXltZW50RGF0YVJlcXVlc3Q7XG4gIG9uUGF5bWVudERhdGFDaGFuZ2VkPzogZ29vZ2xlLnBheW1lbnRzLmFwaS5QYXltZW50RGF0YUNoYW5nZWRIYW5kbGVyO1xuICBvblBheW1lbnRBdXRob3JpemVkPzogZ29vZ2xlLnBheW1lbnRzLmFwaS5QYXltZW50QXV0aG9yaXplZEhhbmRsZXI7XG4gIG9uTG9hZFBheW1lbnREYXRhPzogKHBheW1lbnREYXRhOiBnb29nbGUucGF5bWVudHMuYXBpLlBheW1lbnREYXRhKSA9PiB2b2lkO1xuICBvbkNhbmNlbD86IChyZWFzb246IGdvb2dsZS5wYXltZW50cy5hcGkuUGF5bWVudHNFcnJvcikgPT4gdm9pZDtcbiAgb25FcnJvcj86IChlcnJvcjogRXJyb3IgfCBnb29nbGUucGF5bWVudHMuYXBpLlBheW1lbnRzRXJyb3IpID0+IHZvaWQ7XG4gIG9uUmVhZHlUb1BheUNoYW5nZT86IChyZXN1bHQ6IFJlYWR5VG9QYXlDaGFuZ2VSZXNwb25zZSkgPT4gdm9pZDtcbiAgb25DbGljaz86IChldmVudDogRXZlbnQpID0+IHZvaWQ7XG4gIGJ1dHRvbkNvbG9yPzogZ29vZ2xlLnBheW1lbnRzLmFwaS5CdXR0b25Db2xvcjtcbiAgYnV0dG9uVHlwZT86IGdvb2dsZS5wYXltZW50cy5hcGkuQnV0dG9uVHlwZTtcbiAgYnV0dG9uU2l6ZU1vZGU/OiBnb29nbGUucGF5bWVudHMuYXBpLkJ1dHRvblNpemVNb2RlO1xuICBidXR0b25Mb2NhbGU/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBCdXR0b25NYW5hZ2VyT3B0aW9ucyB7XG4gIGNzc1NlbGVjdG9yOiBzdHJpbmc7XG4gIHNvZnR3YXJlSW5mb0lkOiBzdHJpbmc7XG4gIHNvZnR3YXJlSW5mb1ZlcnNpb246IHN0cmluZztcbn1cblxuLyoqXG4gKiBNYW5hZ2VzIHRoZSBsaWZlY3ljbGUgb2YgdGhlIEdvb2dsZSBQYXkgYnV0dG9uLlxuICpcbiAqIEluY2x1ZGVzIGxpZmVjeWNsZSBtYW5hZ2VtZW50IG9mIHRoZSBgUGF5bWVudHNDbGllbnRgIGluc3RhbmNlLFxuICogYGlzUmVhZHlUb1BheWAsIGBvbkNsaWNrYCwgYGxvYWRQYXltZW50RGF0YWAsIGFuZCBvdGhlciBjYWxsYmFjayBtZXRob2RzLlxuICovXG5leHBvcnQgY2xhc3MgQnV0dG9uTWFuYWdlciB7XG4gIHByaXZhdGUgY2xpZW50PzogZ29vZ2xlLnBheW1lbnRzLmFwaS5QYXltZW50c0NsaWVudDtcbiAgcHJpdmF0ZSBjb25maWc/OiBDb25maWc7XG4gIHByaXZhdGUgZWxlbWVudD86IEVsZW1lbnQ7XG4gIHByaXZhdGUgb3B0aW9uczogQnV0dG9uTWFuYWdlck9wdGlvbnM7XG4gIHByaXZhdGUgb2xkSW52YWxpZGF0aW9uVmFsdWVzPzogYW55W107XG5cbiAgaXNSZWFkeVRvUGF5PzogYm9vbGVhbjtcbiAgcGF5bWVudE1ldGhvZFByZXNlbnQ/OiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IEJ1dHRvbk1hbmFnZXJPcHRpb25zKSB7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIGdldEVsZW1lbnQoKTogRWxlbWVudCB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgfVxuXG4gIHByaXZhdGUgaXNHb29nbGVQYXlMb2FkZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICdnb29nbGUnIGluICh3aW5kb3cgfHwgZ2xvYmFsKSAmJiAhIWdvb2dsZT8ucGF5bWVudHM/LmFwaT8uUGF5bWVudHNDbGllbnQ7XG4gIH1cblxuICBhc3luYyBtb3VudChlbGVtZW50OiBFbGVtZW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmlzR29vZ2xlUGF5TG9hZGVkKCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGxvYWRTY3JpcHQoJ2h0dHBzOi8vcGF5Lmdvb2dsZS5jb20vZ3AvcC9qcy9wYXkuanMnKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBpZiAodGhpcy5jb25maWc/Lm9uRXJyb3IpIHtcbiAgICAgICAgICB0aGlzLmNvbmZpZy5vbkVycm9yKGVyciBhcyBFcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICBpZiAoZWxlbWVudCkge1xuICAgICAgdGhpcy5hcHBlbmRTdHlsZXMoKTtcbiAgICAgIGlmICh0aGlzLmNvbmZpZykge1xuICAgICAgICB0aGlzLnVwZGF0ZUVsZW1lbnQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB1bm1vdW50KCk6IHZvaWQge1xuICAgIHRoaXMuZWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGNvbmZpZ3VyZShuZXdDb25maWc6IENvbmZpZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGxldCBwcm9taXNlOiBQcm9taXNlPHZvaWQ+IHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY29uZmlnID0gbmV3Q29uZmlnO1xuICAgIGlmICghdGhpcy5vbGRJbnZhbGlkYXRpb25WYWx1ZXMgfHwgdGhpcy5pc0NsaWVudEludmFsaWRhdGVkKG5ld0NvbmZpZykpIHtcbiAgICAgIHByb21pc2UgPSB0aGlzLnVwZGF0ZUVsZW1lbnQoKTtcbiAgICB9XG4gICAgdGhpcy5vbGRJbnZhbGlkYXRpb25WYWx1ZXMgPSB0aGlzLmdldEludmFsaWRhdGlvblZhbHVlcyhuZXdDb25maWcpO1xuXG4gICAgcmV0dXJuIHByb21pc2UgPz8gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBjbGllbnQgY29uZmlndXJhdGlvbiBvcHRpb25zIGJhc2VkIG9uIGJ1dHRvbiBjb25maWd1cmF0aW9uXG4gICAqIG9wdGlvbnMuXG4gICAqXG4gICAqIFRoaXMgbWV0aG9kIHdvdWxkIG5vcm1hbGx5IGJlIHByaXZhdGUgYnV0IGhhcyBiZWVuIG1hZGUgcHVibGljIGZvclxuICAgKiB0ZXN0aW5nIHB1cnBvc2VzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgY3JlYXRlQ2xpZW50T3B0aW9ucyhjb25maWc6IENvbmZpZyk6IGdvb2dsZS5wYXltZW50cy5hcGkuUGF5bWVudE9wdGlvbnMge1xuICAgIGNvbnN0IGNsaWVudENvbmZpZzogZ29vZ2xlLnBheW1lbnRzLmFwaS5QYXltZW50T3B0aW9ucyA9IHtcbiAgICAgIGVudmlyb25tZW50OiBjb25maWcuZW52aXJvbm1lbnQsXG4gICAgICBtZXJjaGFudEluZm86IHRoaXMuY3JlYXRlTWVyY2hhbnRJbmZvKGNvbmZpZyksXG4gICAgfTtcblxuICAgIGlmIChjb25maWcub25QYXltZW50RGF0YUNoYW5nZWQgfHwgY29uZmlnLm9uUGF5bWVudEF1dGhvcml6ZWQpIHtcbiAgICAgIGNsaWVudENvbmZpZy5wYXltZW50RGF0YUNhbGxiYWNrcyA9IHt9O1xuXG4gICAgICBpZiAoY29uZmlnLm9uUGF5bWVudERhdGFDaGFuZ2VkKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvZXhwbGljaXQtZnVuY3Rpb24tcmV0dXJuLXR5cGVcbiAgICAgICAgY2xpZW50Q29uZmlnLnBheW1lbnREYXRhQ2FsbGJhY2tzLm9uUGF5bWVudERhdGFDaGFuZ2VkID0gcGF5bWVudERhdGEgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbmZpZy5vblBheW1lbnREYXRhQ2hhbmdlZCEocGF5bWVudERhdGEpO1xuICAgICAgICAgIHJldHVybiByZXN1bHQgfHwgKHt9IGFzIGdvb2dsZS5wYXltZW50cy5hcGkuUGF5bWVudERhdGFSZXF1ZXN0VXBkYXRlKTtcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNvbmZpZy5vblBheW1lbnRBdXRob3JpemVkKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvZXhwbGljaXQtZnVuY3Rpb24tcmV0dXJuLXR5cGVcbiAgICAgICAgY2xpZW50Q29uZmlnLnBheW1lbnREYXRhQ2FsbGJhY2tzLm9uUGF5bWVudEF1dGhvcml6ZWQgPSBwYXltZW50RGF0YSA9PiB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gY29uZmlnLm9uUGF5bWVudEF1dGhvcml6ZWQhKHBheW1lbnREYXRhKTtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0IHx8ICh7fSBhcyBnb29nbGUucGF5bWVudHMuYXBpLlBheW1lbnRBdXRob3JpemF0aW9uUmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY2xpZW50Q29uZmlnO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVJc1JlYWR5VG9QYXlSZXF1ZXN0KGNvbmZpZzogQ29uZmlnKTogZ29vZ2xlLnBheW1lbnRzLmFwaS5Jc1JlYWR5VG9QYXlSZXF1ZXN0IHtcbiAgICBjb25zdCBwYXltZW50UmVxdWVzdCA9IGNvbmZpZy5wYXltZW50UmVxdWVzdDtcbiAgICBjb25zdCByZXF1ZXN0OiBnb29nbGUucGF5bWVudHMuYXBpLklzUmVhZHlUb1BheVJlcXVlc3QgPSB7XG4gICAgICBhcGlWZXJzaW9uOiBwYXltZW50UmVxdWVzdC5hcGlWZXJzaW9uLFxuICAgICAgYXBpVmVyc2lvbk1pbm9yOiBwYXltZW50UmVxdWVzdC5hcGlWZXJzaW9uTWlub3IsXG4gICAgICBhbGxvd2VkUGF5bWVudE1ldGhvZHM6IHBheW1lbnRSZXF1ZXN0LmFsbG93ZWRQYXltZW50TWV0aG9kcyxcbiAgICAgIGV4aXN0aW5nUGF5bWVudE1ldGhvZFJlcXVpcmVkOiBjb25maWcuZXhpc3RpbmdQYXltZW50TWV0aG9kUmVxdWlyZWQsXG4gICAgfTtcblxuICAgIHJldHVybiByZXF1ZXN0O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdHMgYGxvYWRQYXltZW50RGF0YWAgcmVxdWVzdCBvYmplY3QgYmFzZWQgb24gYnV0dG9uIGNvbmZpZ3VyYXRpb24uXG4gICAqXG4gICAqIEl0IGluZmVycyByZXF1ZXN0IHByb3BlcnRpZXMgbGlrZSBgc2hpcHBpbmdBZGRyZXNzUmVxdWlyZWRgLFxuICAgKiBgc2hpcHBpbmdPcHRpb25SZXF1aXJlZGAsIGFuZCBgYmlsbGluZ0FkZHJlc3NSZXF1aXJlZGAgaWYgbm90IGFscmVhZHkgc2V0XG4gICAqIGJhc2VkIG9uIHRoZSBwcmVzZW5jZSBvZiB0aGVpciBhc3NvY2lhdGVkIG9wdGlvbnMgYW5kIHBhcmFtZXRlcnMuIEl0IGFsc29cbiAgICogaW5mZXJzIGBjYWxsYmFja0ludGVudHNgIGJhc2VkIG9uIHRoZSBjYWxsYmFjayBtZXRob2RzIGRlZmluZWQgaW4gYnV0dG9uXG4gICAqIGNvbmZpZ3VyYXRpb24uXG4gICAqXG4gICAqIFRoaXMgbWV0aG9kIHdvdWxkIG5vcm1hbGx5IGJlIHByaXZhdGUgYnV0IGhhcyBiZWVuIG1hZGUgcHVibGljIGZvclxuICAgKiB0ZXN0aW5nIHB1cnBvc2VzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgY3JlYXRlTG9hZFBheW1lbnREYXRhUmVxdWVzdChjb25maWc6IENvbmZpZyk6IGdvb2dsZS5wYXltZW50cy5hcGkuUGF5bWVudERhdGFSZXF1ZXN0IHtcbiAgICBjb25zdCByZXF1ZXN0ID0ge1xuICAgICAgLi4uY29uZmlnLnBheW1lbnRSZXF1ZXN0LFxuICAgICAgbWVyY2hhbnRJbmZvOiB0aGlzLmNyZWF0ZU1lcmNoYW50SW5mbyhjb25maWcpLFxuICAgIH07XG5cbiAgICAvLyBUT0RPOiAjMTMgcmUtZW5hYmxlIGluZmVycmVuY2UgaWYvd2hlbiB3ZSBhZ3JlZSBhcyBhIHRlYW1cblxuICAgIHJldHVybiByZXF1ZXN0O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVNZXJjaGFudEluZm8oY29uZmlnOiBDb25maWcpOiBnb29nbGUucGF5bWVudHMuYXBpLk1lcmNoYW50SW5mbyB7XG4gICAgY29uc3QgbWVyY2hhbnRJbmZvOiBnb29nbGUucGF5bWVudHMuYXBpLk1lcmNoYW50SW5mbyA9IHtcbiAgICAgIC4uLmNvbmZpZy5wYXltZW50UmVxdWVzdC5tZXJjaGFudEluZm8sXG4gICAgfTtcblxuICAgIC8vIGFwcGx5IHNvZnR3YXJlSW5mbyBpZiBub3Qgc2V0XG4gICAgaWYgKCFtZXJjaGFudEluZm8uc29mdHdhcmVJbmZvKSB7XG4gICAgICBtZXJjaGFudEluZm8uc29mdHdhcmVJbmZvID0ge1xuICAgICAgICBpZDogdGhpcy5vcHRpb25zLnNvZnR3YXJlSW5mb0lkLFxuICAgICAgICB2ZXJzaW9uOiB0aGlzLm9wdGlvbnMuc29mdHdhcmVJbmZvVmVyc2lvbixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIG1lcmNoYW50SW5mbztcbiAgfVxuXG4gIHByaXZhdGUgaXNNb3VudGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnQgIT0gbnVsbCAmJiB0aGlzLmVsZW1lbnQuaXNDb25uZWN0ZWQgIT09IGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVCdXR0b24oKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZWxlbWVudCBpbnN0YW5jZW9mIFNoYWRvd1Jvb3QgfHwgdGhpcy5lbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudCkge1xuICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBBcnJheS5mcm9tKHRoaXMuZWxlbWVudC5jaGlsZHJlbikpIHtcbiAgICAgICAgaWYgKGNoaWxkLnRhZ05hbWUgIT09ICdTVFlMRScpIHtcbiAgICAgICAgICBjaGlsZC5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlRWxlbWVudCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuaXNNb3VudGVkKCkpIHJldHVybjtcbiAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5nZXRFbGVtZW50KCkhO1xuXG4gICAgaWYgKCF0aGlzLmNvbmZpZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdnb29nbGUtcGF5LWJ1dHRvbjogTWlzc2luZyBjb25maWd1cmF0aW9uJyk7XG4gICAgfVxuXG4gICAgLy8gcmVtb3ZlIGV4aXN0aW5nIGJ1dHRvblxuICAgIHRoaXMucmVtb3ZlQnV0dG9uKCk7XG5cbiAgICB0aGlzLmNsaWVudCA9IG5ldyBnb29nbGUucGF5bWVudHMuYXBpLlBheW1lbnRzQ2xpZW50KHRoaXMuY3JlYXRlQ2xpZW50T3B0aW9ucyh0aGlzLmNvbmZpZykpO1xuXG4gICAgY29uc3QgYnV0dG9uT3B0aW9uczogZ29vZ2xlLnBheW1lbnRzLmFwaS5CdXR0b25PcHRpb25zID0ge1xuICAgICAgYnV0dG9uVHlwZTogdGhpcy5jb25maWcuYnV0dG9uVHlwZSxcbiAgICAgIGJ1dHRvbkNvbG9yOiB0aGlzLmNvbmZpZy5idXR0b25Db2xvcixcbiAgICAgIGJ1dHRvblNpemVNb2RlOiB0aGlzLmNvbmZpZy5idXR0b25TaXplTW9kZSxcbiAgICAgIGJ1dHRvbkxvY2FsZTogdGhpcy5jb25maWcuYnV0dG9uTG9jYWxlLFxuICAgICAgb25DbGljazogdGhpcy5oYW5kbGVDbGljayxcbiAgICAgIGFsbG93ZWRQYXltZW50TWV0aG9kczogdGhpcy5jb25maWcucGF5bWVudFJlcXVlc3QuYWxsb3dlZFBheW1lbnRNZXRob2RzLFxuICAgIH07XG5cbiAgICBjb25zdCByb290Tm9kZSA9IGVsZW1lbnQuZ2V0Um9vdE5vZGUoKTtcbiAgICBpZiAocm9vdE5vZGUgaW5zdGFuY2VvZiBTaGFkb3dSb290KSB7XG4gICAgICBidXR0b25PcHRpb25zLmJ1dHRvblJvb3ROb2RlID0gcm9vdE5vZGU7XG4gICAgfVxuXG4gICAgLy8gcHJlLWNyZWF0ZSBidXR0b25cbiAgICBjb25zdCBidXR0b24gPSB0aGlzLmNsaWVudC5jcmVhdGVCdXR0b24oYnV0dG9uT3B0aW9ucyk7XG5cbiAgICB0aGlzLnNldENsYXNzTmFtZShlbGVtZW50LCBbZWxlbWVudC5jbGFzc05hbWUsICdub3QtcmVhZHknXSk7XG4gICAgZWxlbWVudC5hcHBlbmRDaGlsZChidXR0b24pO1xuXG4gICAgbGV0IHNob3dCdXR0b24gPSBmYWxzZTtcbiAgICBsZXQgcmVhZHlUb1BheTogZ29vZ2xlLnBheW1lbnRzLmFwaS5Jc1JlYWR5VG9QYXlSZXNwb25zZSB8IHVuZGVmaW5lZDtcblxuICAgIHRyeSB7XG4gICAgICByZWFkeVRvUGF5ID0gYXdhaXQgdGhpcy5jbGllbnQuaXNSZWFkeVRvUGF5KHRoaXMuY3JlYXRlSXNSZWFkeVRvUGF5UmVxdWVzdCh0aGlzLmNvbmZpZykpO1xuICAgICAgc2hvd0J1dHRvbiA9XG4gICAgICAgIChyZWFkeVRvUGF5LnJlc3VsdCAmJiAhdGhpcy5jb25maWcuZXhpc3RpbmdQYXltZW50TWV0aG9kUmVxdWlyZWQpXG4gICAgICAgIHx8IChyZWFkeVRvUGF5LnJlc3VsdCAmJiByZWFkeVRvUGF5LnBheW1lbnRNZXRob2RQcmVzZW50ICYmIHRoaXMuY29uZmlnLmV4aXN0aW5nUGF5bWVudE1ldGhvZFJlcXVpcmVkKVxuICAgICAgICB8fCBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5vbkVycm9yKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLm9uRXJyb3IoZXJyIGFzIEVycm9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuaXNNb3VudGVkKCkpIHJldHVybjtcblxuICAgIGlmIChzaG93QnV0dG9uKSB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLmNsaWVudC5wcmVmZXRjaFBheW1lbnREYXRhKHRoaXMuY3JlYXRlTG9hZFBheW1lbnREYXRhUmVxdWVzdCh0aGlzLmNvbmZpZykpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciB3aXRoIHByZWZldGNoJywgZXJyKTtcbiAgICAgIH1cblxuICAgICAgLy8gcmVtb3ZlIGhpZGRlbiBjbGFzc05hbWVcbiAgICAgIHRoaXMuc2V0Q2xhc3NOYW1lKFxuICAgICAgICBlbGVtZW50LFxuICAgICAgICAoZWxlbWVudC5jbGFzc05hbWUgfHwgJycpLnNwbGl0KCcgJykuZmlsdGVyKGNsYXNzTmFtZSA9PiBjbGFzc05hbWUgJiYgY2xhc3NOYW1lICE9PSAnbm90LXJlYWR5JyksXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzUmVhZHlUb1BheSAhPT0gcmVhZHlUb1BheT8ucmVzdWx0IHx8IHRoaXMucGF5bWVudE1ldGhvZFByZXNlbnQgIT09IHJlYWR5VG9QYXk/LnBheW1lbnRNZXRob2RQcmVzZW50KSB7XG4gICAgICB0aGlzLmlzUmVhZHlUb1BheSA9ICEhcmVhZHlUb1BheT8ucmVzdWx0O1xuICAgICAgdGhpcy5wYXltZW50TWV0aG9kUHJlc2VudCA9IHJlYWR5VG9QYXk/LnBheW1lbnRNZXRob2RQcmVzZW50O1xuXG4gICAgICBpZiAodGhpcy5jb25maWcub25SZWFkeVRvUGF5Q2hhbmdlKSB7XG4gICAgICAgIGNvbnN0IHJlYWR5VG9QYXlSZXNwb25zZTogUmVhZHlUb1BheUNoYW5nZVJlc3BvbnNlID0ge1xuICAgICAgICAgIGlzQnV0dG9uVmlzaWJsZTogc2hvd0J1dHRvbixcbiAgICAgICAgICBpc1JlYWR5VG9QYXk6IHRoaXMuaXNSZWFkeVRvUGF5LFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0aGlzLnBheW1lbnRNZXRob2RQcmVzZW50KSB7XG4gICAgICAgICAgcmVhZHlUb1BheVJlc3BvbnNlLnBheW1lbnRNZXRob2RQcmVzZW50ID0gdGhpcy5wYXltZW50TWV0aG9kUHJlc2VudDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY29uZmlnLm9uUmVhZHlUb1BheUNoYW5nZShyZWFkeVRvUGF5UmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHRoZSBjbGljayBldmVudCBvZiB0aGUgR29vZ2xlIFBheSBidXR0b24uXG4gICAqXG4gICAqIFRoaXMgbWV0aG9kIHdvdWxkIG5vcm1hbGx5IGJlIHByaXZhdGUgYnV0IGhhcyBiZWVuIG1hZGUgcHVibGljIGZvclxuICAgKiB0ZXN0aW5nIHB1cnBvc2VzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgaGFuZGxlQ2xpY2sgPSBhc3luYyAoZXZlbnQ6IEV2ZW50KTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgY29uc3QgY29uZmlnID0gdGhpcy5jb25maWc7XG4gICAgaWYgKCFjb25maWcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignZ29vZ2xlLXBheS1idXR0b246IE1pc3NpbmcgY29uZmlndXJhdGlvbicpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLmNyZWF0ZUxvYWRQYXltZW50RGF0YVJlcXVlc3QoY29uZmlnKTtcblxuICAgIHRyeSB7XG4gICAgICBpZiAoY29uZmlnLm9uQ2xpY2spIHtcbiAgICAgICAgY29uZmlnLm9uQ2xpY2soZXZlbnQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2xpZW50IS5sb2FkUGF5bWVudERhdGEocmVxdWVzdCk7XG5cbiAgICAgIGlmIChjb25maWcub25Mb2FkUGF5bWVudERhdGEpIHtcbiAgICAgICAgY29uZmlnLm9uTG9hZFBheW1lbnREYXRhKHJlc3VsdCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoKGVyciBhcyBnb29nbGUucGF5bWVudHMuYXBpLlBheW1lbnRzRXJyb3IpLnN0YXR1c0NvZGUgPT09ICdDQU5DRUxFRCcpIHtcbiAgICAgICAgaWYgKGNvbmZpZy5vbkNhbmNlbCkge1xuICAgICAgICAgIGNvbmZpZy5vbkNhbmNlbChlcnIgYXMgZ29vZ2xlLnBheW1lbnRzLmFwaS5QYXltZW50c0Vycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChjb25maWcub25FcnJvcikge1xuICAgICAgICBjb25maWcub25FcnJvcihlcnIgYXMgZ29vZ2xlLnBheW1lbnRzLmFwaS5QYXltZW50c0Vycm9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcHJpdmF0ZSBzZXRDbGFzc05hbWUoZWxlbWVudDogRWxlbWVudCwgY2xhc3NOYW1lczogc3RyaW5nW10pOiB2b2lkIHtcbiAgICBjb25zdCBjbGFzc05hbWUgPSBjbGFzc05hbWVzLmZpbHRlcihuYW1lID0+IG5hbWUpLmpvaW4oJyAnKTtcbiAgICBpZiAoY2xhc3NOYW1lKSB7XG4gICAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2NsYXNzJyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhcHBlbmRTdHlsZXMoKTogdm9pZCB7XG4gICAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjtcblxuICAgIGNvbnN0IHJvb3ROb2RlID0gdGhpcy5lbGVtZW50Py5nZXRSb290Tm9kZSgpIGFzIERvY3VtZW50IHwgU2hhZG93Um9vdCB8IHVuZGVmaW5lZDtcbiAgICBjb25zdCBzdHlsZUlkID0gYGRlZmF1bHQtZ29vZ2xlLXN0eWxlLSR7dGhpcy5vcHRpb25zLmNzc1NlbGVjdG9yLnJlcGxhY2UoL1teXFx3LV0rL2csICcnKX0tJHtcbiAgICAgIHRoaXMuY29uZmlnPy5idXR0b25Mb2NhbGVcbiAgICB9YDtcblxuICAgIC8vIGluaXRpYWxpemUgc3R5bGVzIGlmIHJlbmRlcmluZyBvbiB0aGUgY2xpZW50OlxuICAgIGlmIChyb290Tm9kZSkge1xuICAgICAgaWYgKCFyb290Tm9kZS5nZXRFbGVtZW50QnlJZD8uKHN0eWxlSWQpKSB7XG4gICAgICAgIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgICAgICAgc3R5bGUuaWQgPSBzdHlsZUlkO1xuICAgICAgICBzdHlsZS50eXBlID0gJ3RleHQvY3NzJztcbiAgICAgICAgc3R5bGUuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICR7dGhpcy5vcHRpb25zLmNzc1NlbGVjdG9yfSB7XG4gICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgICAgICAgfVxuICAgICAgICAgICR7dGhpcy5vcHRpb25zLmNzc1NlbGVjdG9yfS5ub3QtcmVhZHkge1xuICAgICAgICAgICAgd2lkdGg6IDA7XG4gICAgICAgICAgICBoZWlnaHQ6IDA7XG4gICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICAgIH1cbiAgICAgICAgYDtcblxuICAgICAgICBpZiAocm9vdE5vZGUgaW5zdGFuY2VvZiBEb2N1bWVudCAmJiByb290Tm9kZS5oZWFkKSB7XG4gICAgICAgICAgcm9vdE5vZGUuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcm9vdE5vZGUuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc0NsaWVudEludmFsaWRhdGVkKG5ld0NvbmZpZzogQ29uZmlnKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLm9sZEludmFsaWRhdGlvblZhbHVlcykgcmV0dXJuIHRydWU7XG5cbiAgICBjb25zdCBuZXdWYWx1ZXMgPSB0aGlzLmdldEludmFsaWRhdGlvblZhbHVlcyhuZXdDb25maWcpO1xuICAgIHJldHVybiBuZXdWYWx1ZXMuc29tZSgodmFsdWUsIGluZGV4KSA9PiB2YWx1ZSAhPT0gdGhpcy5vbGRJbnZhbGlkYXRpb25WYWx1ZXMhW2luZGV4XSk7XG4gIH1cblxuICBwcml2YXRlIGdldEludmFsaWRhdGlvblZhbHVlcyhjb25maWc6IENvbmZpZyk6IGFueVtdIHtcbiAgICByZXR1cm4gW1xuICAgICAgY29uZmlnLmVudmlyb25tZW50LFxuICAgICAgY29uZmlnLmV4aXN0aW5nUGF5bWVudE1ldGhvZFJlcXVpcmVkLFxuICAgICAgISFjb25maWcub25QYXltZW50RGF0YUNoYW5nZWQsXG4gICAgICAhIWNvbmZpZy5vblBheW1lbnRBdXRob3JpemVkLFxuICAgICAgY29uZmlnLmJ1dHRvbkNvbG9yLFxuICAgICAgY29uZmlnLmJ1dHRvblR5cGUsXG4gICAgICBjb25maWcuYnV0dG9uTG9jYWxlLFxuICAgICAgY29uZmlnLmJ1dHRvblNpemVNb2RlLFxuICAgICAgY29uZmlnLnBheW1lbnRSZXF1ZXN0Lm1lcmNoYW50SW5mby5tZXJjaGFudElkLFxuICAgICAgY29uZmlnLnBheW1lbnRSZXF1ZXN0Lm1lcmNoYW50SW5mby5tZXJjaGFudE5hbWUsXG4gICAgICBjb25maWcucGF5bWVudFJlcXVlc3QubWVyY2hhbnRJbmZvLnNvZnR3YXJlSW5mbz8uaWQsXG4gICAgICBjb25maWcucGF5bWVudFJlcXVlc3QubWVyY2hhbnRJbmZvLnNvZnR3YXJlSW5mbz8udmVyc2lvbixcbiAgICAgIGNvbmZpZy5wYXltZW50UmVxdWVzdC5hbGxvd2VkUGF5bWVudE1ldGhvZHMsXG4gICAgXTtcbiAgfVxufVxuIl19