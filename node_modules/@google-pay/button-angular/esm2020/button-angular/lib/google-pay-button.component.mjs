/**
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { ButtonManager } from '../../lib/button-manager';
import { Directive, Input } from '@angular/core';
import { name as softwareId, version as softwareVersion } from '../package.json';
import { debounce } from '../../lib/debounce';
import * as i0 from "@angular/core";
export class GooglePayButtonComponent {
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.manager = new ButtonManager({
            cssSelector: 'google-pay-button',
            softwareInfoId: softwareId,
            softwareInfoVersion: softwareVersion,
        });
        this.initializeButton = debounce(() => {
            if (!this.assertRequiredProperty('paymentRequest')) {
                return;
            }
            if (!this.assertRequiredProperty('environment')) {
                return;
            }
            const config = {
                paymentRequest: this.paymentRequest,
                environment: this.environment,
                existingPaymentMethodRequired: this.existingPaymentMethodRequired,
                onPaymentDataChanged: this.paymentDataChangedCallback,
                onPaymentAuthorized: this.paymentAuthorizedCallback,
                buttonColor: this.buttonColor,
                buttonType: this.buttonType,
                buttonSizeMode: this.buttonSizeMode,
                buttonLocale: this.buttonLocale,
                onReadyToPayChange: result => {
                    if (this.readyToPayChangeCallback) {
                        this.readyToPayChangeCallback(result);
                    }
                    this.dispatch('readytopaychange', result);
                },
                onCancel: reason => {
                    if (this.cancelCallback) {
                        this.cancelCallback(reason);
                    }
                    this.dispatch('cancel', reason);
                },
                onError: error => {
                    if (this.errorCallback) {
                        this.errorCallback?.(error);
                    }
                    this.elementRef.nativeElement.dispatchEvent(new ErrorEvent('error', { error }));
                },
                onLoadPaymentData: paymentData => {
                    if (this.loadPaymentDataCallback) {
                        this.loadPaymentDataCallback(paymentData);
                    }
                    this.dispatch('loadpaymentdata', paymentData);
                },
                onClick: event => {
                    if (this.clickCallback) {
                        this.clickCallback?.(event);
                    }
                },
            };
            this.manager.configure(config);
        });
    }
    get isReadyToPay() {
        return this.manager.isReadyToPay;
    }
    ngOnInit() {
        return this.manager.mount(this.elementRef.nativeElement);
    }
    ngOnChanges() {
        return this.initializeButton();
    }
    assertRequiredProperty(name) {
        const value = this[name];
        if (value === null || value === undefined) {
            this.throwError(Error(`Required property not set: ${name}`));
            return false;
        }
        return true;
    }
    /**
     * Throws an error.
     *
     * Used for testing purposes so that the method can be spied on.
     */
    throwError(error) {
        throw error;
    }
    dispatch(type, detail) {
        this.elementRef.nativeElement.dispatchEvent(new CustomEvent(type, {
            bubbles: true,
            cancelable: false,
            detail,
        }));
    }
}
GooglePayButtonComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.0.2", ngImport: i0, type: GooglePayButtonComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Directive });
GooglePayButtonComponent.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "15.0.2", type: GooglePayButtonComponent, selector: "google-pay-button", inputs: { paymentRequest: "paymentRequest", environment: "environment", existingPaymentMethodRequired: "existingPaymentMethodRequired", buttonColor: "buttonColor", buttonType: "buttonType", buttonSizeMode: "buttonSizeMode", buttonLocale: "buttonLocale", paymentDataChangedCallback: "paymentDataChangedCallback", paymentAuthorizedCallback: "paymentAuthorizedCallback", readyToPayChangeCallback: "readyToPayChangeCallback", loadPaymentDataCallback: "loadPaymentDataCallback", cancelCallback: "cancelCallback", errorCallback: "errorCallback", clickCallback: "clickCallback" }, usesOnChanges: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.0.2", ngImport: i0, type: GooglePayButtonComponent, decorators: [{
            type: Directive,
            args: [{
                    selector: 'google-pay-button',
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { paymentRequest: [{
                type: Input
            }], environment: [{
                type: Input
            }], existingPaymentMethodRequired: [{
                type: Input
            }], buttonColor: [{
                type: Input
            }], buttonType: [{
                type: Input
            }], buttonSizeMode: [{
                type: Input
            }], buttonLocale: [{
                type: Input
            }], paymentDataChangedCallback: [{
                type: Input
            }], paymentAuthorizedCallback: [{
                type: Input
            }], readyToPayChangeCallback: [{
                type: Input
            }], loadPaymentDataCallback: [{
                type: Input
            }], cancelCallback: [{
                type: Input
            }], errorCallback: [{
                type: Input
            }], clickCallback: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZ2xlLXBheS1idXR0b24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbGliL2dvb2dsZS1wYXktYnV0dG9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7R0FjRztBQUVILE9BQU8sRUFBRSxhQUFhLEVBQVUsTUFBTSwwQkFBMEIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsU0FBUyxFQUFjLEtBQUssRUFBcUIsTUFBTSxlQUFlLENBQUM7QUFDaEYsT0FBTyxFQUFFLElBQUksSUFBSSxVQUFVLEVBQUUsT0FBTyxJQUFJLGVBQWUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2pGLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQzs7QUFLOUMsTUFBTSxPQUFPLHdCQUF3QjtJQXNCbkMsWUFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQXJCbEMsWUFBTyxHQUFHLElBQUksYUFBYSxDQUFDO1lBQ2xDLFdBQVcsRUFBRSxtQkFBbUI7WUFDaEMsY0FBYyxFQUFFLFVBQVU7WUFDMUIsbUJBQW1CLEVBQUUsZUFBZTtTQUNyQyxDQUFDLENBQUM7UUErQksscUJBQWdCLEdBQUcsUUFBUSxDQUFDLEdBQUcsRUFBRTtZQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLGdCQUFnQixDQUFDLEVBQUU7Z0JBQ2xELE9BQU87YUFDUjtZQUVELElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsYUFBYSxDQUFDLEVBQUU7Z0JBQy9DLE9BQU87YUFDUjtZQUVELE1BQU0sTUFBTSxHQUFXO2dCQUNyQixjQUFjLEVBQUUsSUFBSSxDQUFDLGNBQWM7Z0JBQ25DLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVztnQkFDN0IsNkJBQTZCLEVBQUUsSUFBSSxDQUFDLDZCQUE2QjtnQkFDakUsb0JBQW9CLEVBQUUsSUFBSSxDQUFDLDBC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TyxFQUFFLElBQUk7WUFDYixVQUFVLEVBQUUsS0FBSztZQUNqQixNQUFNO1NBQ1AsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDOztxSEFwSFUsd0JBQXdCO3lHQUF4Qix3QkFBd0I7MkZBQXhCLHdCQUF3QjtrQkFIcEMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsbUJBQW1CO2lCQUM5QjtpR0FRVSxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBQ0csNkJBQTZCO3NCQUFyQyxLQUFLO2dCQUNHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLFlBQVk7c0JBQXBCLEtBQUs7Z0JBQ0csMEJBQTBCO3NCQUFsQyxLQUFLO2dCQUNHLHlCQUF5QjtzQkFBakMsS0FBSztnQkFDRyx3QkFBd0I7c0JBQWhDLEtBQUs7Z0JBQ0csdUJBQXVCO3NCQUEvQixLQUFLO2dCQUNHLGNBQWM7c0JBQXRCLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBCdXR0b25NYW5hZ2VyLCBDb25maWcgfSBmcm9tICcuLi8uLi9saWIvYnV0dG9uLW1hbmFnZXInO1xuaW1wb3J0IHsgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IG5hbWUgYXMgc29mdHdhcmVJZCwgdmVyc2lvbiBhcyBzb2Z0d2FyZVZlcnNpb24gfSBmcm9tICcuLi9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgZGVib3VuY2UgfSBmcm9tICcuLi8uLi9saWIvZGVib3VuY2UnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdnb29nbGUtcGF5LWJ1dHRvbicsXG59KVxuZXhwb3J0IGNsYXNzIEdvb2dsZVBheUJ1dHRvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgcHJpdmF0ZSBtYW5hZ2VyID0gbmV3IEJ1dHRvbk1hbmFnZXIoe1xuICAgIGNzc1NlbGVjdG9yOiAnZ29vZ2xlLXBheS1idXR0b24nLFxuICAgIHNvZnR3YXJlSW5mb0lkOiBzb2Z0d2FyZUlkLFxuICAgIHNvZnR3YXJlSW5mb1ZlcnNpb246IHNvZnR3YXJlVmVyc2lvbixcbiAgfSk7XG5cbiAgQElucHV0KCkgcGF5bWVudFJlcXVlc3QhOiBnb29nbGUucGF5bWVudHMuYXBpLlBheW1lbnREYXRhUmVxdWVzdDtcbiAgQElucHV0KCkgZW52aXJvbm1lbnQhOiBnb29nbGUucGF5bWVudHMuYXBpLkVudmlyb25tZW50O1xuICBASW5wdXQoKSBleGlzdGluZ1BheW1lbnRNZXRob2RSZXF1aXJlZCE6IGJvb2xlYW47XG4gIEBJbnB1dCgpIGJ1dHRvbkNvbG9yPzogZ29vZ2xlLnBheW1lbnRzLmFwaS5CdXR0b25Db2xvcjtcbiAgQElucHV0KCkgYnV0dG9uVHlwZT86IGdvb2dsZS5wYXltZW50cy5hcGkuQnV0dG9uVHlwZTtcbiAgQElucHV0KCkgYnV0dG9uU2l6ZU1vZGU/OiBnb29nbGUucGF5bWVudHMuYXBpLkJ1dHRvblNpemVNb2RlO1xuICBASW5wdXQoKSBidXR0b25Mb2NhbGU/OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHBheW1lbnREYXRhQ2hhbmdlZENhbGxiYWNrPzogZ29vZ2xlLnBheW1lbnRzLmFwaS5QYXltZW50RGF0YUNoYW5nZWRIYW5kbGVyO1xuICBASW5wdXQoKSBwYXltZW50QXV0aG9yaXplZENhbGxiYWNrPzogZ29vZ2xlLnBheW1lbnRzLmFwaS5QYXltZW50QXV0aG9yaXplZEhhbmRsZXI7XG4gIEBJbnB1dCgpIHJlYWR5VG9QYXlDaGFuZ2VDYWxsYmFjaz86IChyZXN1bHQ6IGFueSkgPT4gdm9pZDtcbiAgQElucHV0KCkgbG9hZFBheW1lbnREYXRhQ2FsbGJhY2s/OiAocGF5bWVudERhdGE6IGdvb2dsZS5wYXltZW50cy5hcGkuUGF5bWVudERhdGEpID0+IHZvaWQ7XG4gIEBJbnB1dCgpIGNhbmNlbENhbGxiYWNrPzogKHJlYXNvbjogZ29vZ2xlLnBheW1lbnRzLmFwaS5QYXltZW50c0Vycm9yKSA9PiB2b2lkO1xuICBASW5wdXQoKSBlcnJvckNhbGxiYWNrPzogKGVycm9yOiBFcnJvciB8IGdvb2dsZS5wYXltZW50cy5hcGkuUGF5bWVudHNFcnJvcikgPT4gdm9pZDtcbiAgQElucHV0KCkgY2xpY2tDYWxsYmFjaz86IChldmVudDogRXZlbnQpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7fVxuXG4gIGdldCBpc1JlYWR5VG9QYXkoKTogYm9vbGVhbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMubWFuYWdlci5pc1JlYWR5VG9QYXk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5tYW5hZ2VyLm1vdW50KHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLmluaXRpYWxpemVCdXR0b24oKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZUJ1dHRvbiA9IGRlYm91bmNlKCgpID0+IHtcbiAgICBpZiAoIXRoaXMuYXNzZXJ0UmVxdWlyZWRQcm9wZXJ0eSgncGF5bWVudFJlcXVlc3QnKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5hc3NlcnRSZXF1aXJlZFByb3BlcnR5KCdlbnZpcm9ubWVudCcpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgY29uZmlnOiBDb25maWcgPSB7XG4gICAgICBwYXltZW50UmVxdWVzdDogdGhpcy5wYXltZW50UmVxdWVzdCxcbiAgICAgIGVudmlyb25tZW50OiB0aGlzLmVudmlyb25tZW50LFxuICAgICAgZXhpc3RpbmdQYXltZW50TWV0aG9kUmVxdWlyZWQ6IHRoaXMuZXhpc3RpbmdQYXltZW50TWV0aG9kUmVxdWlyZWQsXG4gICAgICBvblBheW1lbnREYXRhQ2hhbmdlZDogdGhpcy5wYXltZW50RGF0YUNoYW5nZWRDYWxsYmFjayxcbiAgICAgIG9uUGF5bWVudEF1dGhvcml6ZWQ6IHRoaXMucGF5bWVudEF1dGhvcml6ZWRDYWxsYmFjayxcbiAgICAgIGJ1dHRvbkNvbG9yOiB0aGlzLmJ1dHRvbkNvbG9yLFxuICAgICAgYnV0dG9uVHlwZTogdGhpcy5idXR0b25UeXBlLFxuICAgICAgYnV0dG9uU2l6ZU1vZGU6IHRoaXMuYnV0dG9uU2l6ZU1vZGUsXG4gICAgICBidXR0b25Mb2NhbGU6IHRoaXMuYnV0dG9uTG9jYWxlLFxuICAgICAgb25SZWFkeVRvUGF5Q2hhbmdlOiByZXN1bHQgPT4ge1xuICAgICAgICBpZiAodGhpcy5yZWFkeVRvUGF5Q2hhbmdlQ2FsbGJhY2spIHtcbiAgICAgICAgICB0aGlzLnJlYWR5VG9QYXlDaGFuZ2VDYWxsYmFjayhyZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGlzcGF0Y2goJ3JlYWR5dG9wYXljaGFuZ2UnLCByZXN1bHQpO1xuICAgICAgfSxcbiAgICAgIG9uQ2FuY2VsOiByZWFzb24gPT4ge1xuICAgICAgICBpZiAodGhpcy5jYW5jZWxDYWxsYmFjaykge1xuICAgICAgICAgIHRoaXMuY2FuY2VsQ2FsbGJhY2socmVhc29uKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpc3BhdGNoKCdjYW5jZWwnLCByZWFzb24pO1xuICAgICAgfSxcbiAgICAgIG9uRXJyb3I6IGVycm9yID0+IHtcbiAgICAgICAgaWYgKHRoaXMuZXJyb3JDYWxsYmFjaykge1xuICAgICAgICAgIHRoaXMuZXJyb3JDYWxsYmFjaz8uKGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5kaXNwYXRjaEV2ZW50KG5ldyBFcnJvckV2ZW50KCdlcnJvcicsIHsgZXJyb3IgfSkpO1xuICAgICAgfSxcbiAgICAgIG9uTG9hZFBheW1lbnREYXRhOiBwYXltZW50RGF0YSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmxvYWRQYXltZW50RGF0YUNhbGxiYWNrKSB7XG4gICAgICAgICAgdGhpcy5sb2FkUGF5bWVudERhdGFDYWxsYmFjayhwYXltZW50RGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kaXNwYXRjaCgnbG9hZHBheW1lbnRkYXRhJywgcGF5bWVudERhdGEpO1xuICAgICAgfSxcbiAgICAgIG9uQ2xpY2s6IGV2ZW50ID0+IHtcbiAgICAgICAgaWYgKHRoaXMuY2xpY2tDYWxsYmFjaykge1xuICAgICAgICAgIHRoaXMuY2xpY2tDYWxsYmFjaz8uKGV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgdGhpcy5tYW5hZ2VyLmNvbmZpZ3VyZShjb25maWcpO1xuICB9KTtcblxuICBwcml2YXRlIGFzc2VydFJlcXVpcmVkUHJvcGVydHkobmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgdmFsdWUgPSAodGhpcyBhcyBhbnkpW25hbWVdO1xuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnRocm93RXJyb3IoRXJyb3IoYFJlcXVpcmVkIHByb3BlcnR5IG5vdCBzZXQ6ICR7bmFtZX1gKSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVGhyb3dzIGFuIGVycm9yLlxuICAgKlxuICAgKiBVc2VkIGZvciB0ZXN0aW5nIHB1cnBvc2VzIHNvIHRoYXQgdGhlIG1ldGhvZCBjYW4gYmUgc3BpZWQgb24uXG4gICAqL1xuICBwcml2YXRlIHRocm93RXJyb3IoZXJyb3I6IEVycm9yKTogbmV2ZXIge1xuICAgIHRocm93IGVycm9yO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNwYXRjaDxUPih0eXBlOiBzdHJpbmcsIGRldGFpbDogVCk6IHZvaWQge1xuICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmRpc3BhdGNoRXZlbnQoXG4gICAgICBuZXcgQ3VzdG9tRXZlbnQodHlwZSwge1xuICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICBjYW5jZWxhYmxlOiBmYWxzZSxcbiAgICAgICAgZGV0YWlsLFxuICAgICAgfSksXG4gICAgKTtcbiAgfVxufVxuIl19